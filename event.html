<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="prefetch" href="/event.html">
    <!-- Google analytics tag -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G1N2QCDNHH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-G1N2QCDNHH');
    </script>
    <meta charset="utf-8">
    <title>Williamstown High School — Events</title>
    <meta name="description" content="Explore Williamstown High School athletics, arts, and academic events in one campus calendar.">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="https://cloud-eliqwphhl-hack-club-bot.vercel.app/0untitled_design__13_.png" rel="icon" type="image/png">
    <script src="js/config.js"></script>
    <script src="js/site-runtime.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800" rel="stylesheet">
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- poppins font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- jQuery + UI from cdn -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="style2.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        /* nav menu */
        .nav-menu, .nav-menu * { margin: 0; padding: 0; list-style: none; }
        .nav-menu ul { position: absolute; display: none; top: 100%; left: 0; z-index: 99; }
        .nav-menu li { position: relative; white-space: nowrap; }
        .nav-menu > li { float: left; }
        .nav-menu li:hover > ul, .nav-menu li.sfHover > ul { display: block; }
        .nav-menu ul ul { top: 0; left: 100%; }
        .nav-menu ul li { min-width: 180px; }
        .sf-arrows .sf-with-ul { padding-right: 30px; }
        .sf-arrows .sf-with-ul:after { content: "\f107"; position: absolute; right: 15px; font-family: FontAwesome; font-style: normal; font-weight: normal; }
        .sf-arrows ul .sf-with-ul:after { content: "\f105"; }
        #nav-menu-container { float: right; margin: 0; padding-right: 65px; }
        .nav-menu a { padding: 8px; text-decoration: none; display: inline-block; color: rgba(255, 255, 255, 0.8); font-family: "Raleway"; font-weight: 600; font-size: 14px; outline: none; }
        .nav-menu .menu-active a, .nav-menu a:hover { color: #fff; }
        .nav-menu > li { margin-left: 8px; }
        .nav-menu > li > a:before { content: ""; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; background-color: #26b2e4; visibility: hidden; transition: all 0.3s ease-in-out 0s; }
        .nav-menu a:hover:before, .nav-menu li:hover > a:before, .nav-menu .menu-active > a:before { visibility: visible; width: 100%; }
        .nav-menu li.buy-tickets a { color: #fff; background: #1c3fa8; padding: 7px 22px; border-radius: 50px; border: 2px solid #1c3fa8; transition: all ease-in-out 0.3s; font-weight: 500; margin-left: 8px; margin-top: 2px; line-height: 1; font-size: 13px; }
        .nav-menu li.buy-tickets a:hover { background: #26b2e4; border-color: #26b2e4; }
        .nav-menu li.buy-tickets:hover a:before, .nav-menu li.buy-tickets.menu-active a:before { visibility: hidden; }
        .nav-menu ul { margin: 4px 0 0 0; padding: 10px; box-shadow: 0px 0px 30px rgba(127, 137, 161, 0.25); background: #fff; border-radius: 3px; }
        .nav-menu ul li { transition: 0.3s; }
        .nav-menu ul li a { padding: 10px; color: #060c22; transition: 0.3s; display: block; font-size: 13px; text-transform: none; border-radius: 3px; }
        .nav-menu ul li:hover > a { background: #1c3fa8; color: #fff; }
        .nav-menu ul ul { margin: 0; }
        #header { height: 70px; padding: 15px 0; position: fixed; left: 0; top: 0; right: 0; background: rgba(7, 21, 51, 0.95); transition: all 0.5s; z-index: 997; }
        #header #logo img { padding: 0; margin: 0; max-height: 40px; padding-left: 80px; }
        #logo img { filter: brightness(0) invert(1); }

        /* main content styles */
        body { background: #f8f9fa; padding-top: 70px; color: #2f3138; font-family: sans-serif; }

        /* filter sidebar on the left */
        .filter-sidebar { background: #fff; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); padding: 1.5rem; }
        .filter-section { margin-bottom: 1.5rem; border-bottom: 1px solid #eee; }
        .filter-header { cursor: pointer; padding: 0.5rem 0; display: flex; justify-content: space-between; align-items: center; }
        .filter-options { max-height: 0; overflow: hidden; transition: all 0.3s ease; }
        .filter-section.active .filter-options { max-height: 500px; padding: 0.5rem 0; }
        .checkbox-item { display: flex; align-items: center; padding: 0.5rem; border-radius: 4px; transition: all 0.2s ease; }
        .checkbox-item:hover { background: #f8f9fa; }

        /* my custom checkboxes */
        .checkbox-item input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #1c3fa8;
            border-radius: 4px;
            margin-right: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .checkbox-item input[type="checkbox"]:checked {
            background-color: #1c3fa8;
            border-color: #1c3fa8;
            box-shadow: 0 0 0 3px rgba(38,178,228,0.18);
        }
        .checkbox-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            width: 100%;
        }
        .checkbox-item span { flex: 1; }

        /* how event cards look */
        .event-card { background: #fff; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; height: 100%; }
        .event-card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(28,63,168,0.12), 0 12px 20px rgba(38,178,228,0.12); }
        .date-tag { background: #1c3fa8; color: white; padding: 0.4rem 1rem; border-radius: 20px; font-weight: 600; font-size: 0.9rem; min-width: 70px; text-align: center; }
        .event-meta { display: flex; gap: 1rem; align-items: center; color: #6c757d; font-size: 0.875rem; }
        .event-description { flex-grow: 1; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; min-height: 72px; margin-bottom: 1rem; }

        /* grid/list view buttons */
        .view-toggle { border: 2px solid #d6ddeb; border-radius: 6px; padding: 0.5rem 1rem; transition: all 0.3s ease; background: #fff; color: #1b1f36; }
        .view-toggle:hover { border-color: #1c3fa8; color: #1c3fa8; }
        .view-toggle.active { border-color: #1c3fa8; background: rgba(38, 178, 228, 0.12); color: #071533; }

        /* some fade animations */
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-out { animation: fadeOut 0.5s ease forwards; }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(20px); } }

        /* clear filters btn & email section */
        .clear-filters { background: #f8f9fa; color: #2f3138; border: 1px solid #dee2e6; transition: all 0.3s ease; }
        .clear-filters:hover { background: #1c3fa8; color: white; border-color: #1c3fa8; }
        .email-section { background: #fff; border: 1px solid #dee2e6; border-radius: 8px; }
        .tech-highlight {
            margin-top: 1.5rem;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.25rem;
            box-shadow: 0 8px 20px rgba(28, 63, 168, 0.08);
        }
        .tech-highlight h3 {
            font-size: 1rem;
            font-weight: 700;
            color: #1c3fa8;
            margin-bottom: 0.5rem;
        }
        .tech-highlight p {
            font-size: 0.9rem;
            color: #334155;
            line-height: 1.5;
        }
        .register-button { width: 75%; margin: 0 auto; transition: all 0.3s ease; }
        .list-view-price { min-width: 80px; text-align: right; }

        /* ticket purchase popup */
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 9999; }
        .popup-overlay.active { opacity: 1; pointer-events: auto; }
        .ticket-popup { display: block; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: white; width: 90%; max-width: 800px; border-radius: 20px; padding: 2rem; box-shadow: 0 0 40px rgba(28,63,168,0.15); z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; max-height: 90vh; overflow-y: auto; }
        .ticket-popup.active { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
        .popup-close { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; color: #2f3138; transition: all 0.3s; }
        .popup-close:hover { color: #1c3fa8; }
        .popup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .event-details { padding-right: 2rem; border-right: 2px solid #eee; }
        .seating-chart { background: #f8f9fa; padding: 1rem; border-radius: 10px; height: 400px; align-items: center; justify-content: center; margin: 1rem 0; overflow: hidden; position: relative; padding-bottom: 100px;}
        .schedule-table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .schedule-table td { padding: 0.8rem; border-bottom: 1px solid #eee; }
        .schedule-table tr:last-child td { border-bottom: none; }
        .availability { display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 1rem; border-radius: 10px; margin: 1rem 0; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #1c3fa8; box-shadow: 0 0 0 3px rgba(38,178,228,0.18); }
        .cc-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .purchase-button { background: linear-gradient(90deg, #1c3fa8 0%, #26b2e4 100%); color: white; width: 100%; padding: 1rem; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; }
        .purchase-button:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(28,63,168,0.18); }
        .ticket-popup { max-width: 95%; max-height: 90vh; overflow-y: auto; padding: 1rem; }
        .popup-grid { grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 768px) { .popup-grid { grid-template-columns: 1fr 1fr; } }
        .event-details { padding-right: 0; border-right: none; border-bottom: 2px solid #eee; padding-bottom: 1rem; margin-bottom: 1rem; }

        /* seating chart diagram styles */
        .arena-container, .arena-container2 { transform: scale(0.6); transform-origin: center; width: 166.67%; height: 166.67%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.6); }
        .arena-container { position: relative; border: 4px solid #1c3fa8; background: rgba(28, 63, 168, 0.12); border-radius: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); min-height: 600px; margin: 2rem auto; max-width: 1200px; }
        .arena-container2 { position: relative; border: 4px solid #1c3fa8; background: rgba(28, 63, 168, 0.12); border-radius: 30px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); min-height: 600px; margin: 2rem auto; max-width: 1200px; }
        .arena-container::after, .arena-container2::after { content: ''; position: absolute; top: 60px; left: 60px; right: 60px; bottom: 60px; border: 4px solid #1c3fa8; pointer-events: none; z-index: 1; border-radius: 2px; background: #fff; }
        .capacity-section { position: absolute; background: transparent !important; color: #071533; display: flex; align-items: center; justify-content: center; font-weight: 600; z-index: 2; padding: 8px; border: none !important; cursor: pointer; transition: all 0.3s ease; }
        .north { top: 4px; left: 60px; right: 60px; height: 40px; border-top: 2px solid #1c3fa8; border-bottom: 2px solid #1c3fa8; }
        .south { bottom: 4px; left: 60px; right: 60px; height: 40px; border-bottom: 2px solid #1c3fa8; border-top: 2px solid #1c3fa8; }
        .east, .west { writing-mode: vertical-rl; transform: rotate(180deg); width: 40px; top: 60px; bottom: 60px; }
        .east { right: 4px; padding-left: 8px; border-right: 2px solid #1c3fa8; border-left: 2px solid #1c3fa8; }
        .west { left: 4px; padding-right: 8px; border-left: 2px solid #1c3fa8; border-right: 2px solid #1c3fa8; }
        .main-floor { position: absolute; top: 100px; left: 100px; right: 100px; bottom: 100px; background: #fff; z-index: 2; overflow: hidden; }
        .main-floor2 { position: absolute; top: 60px; left: 60px; right: 60px; bottom: 60px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .court-text { font-size: 3rem; font-weight: bold; color: #1c3fa8; z-index: 10; text-align: center; }
        .court-subtext { font-size: 2rem; color: #666; z-index: 10; text-align: center; }
        .stage-container { position: absolute; top: 80px; left: 80px; right: 80px; height: 60px; z-index: 3; border-radius: 15px; background: #1c3fa8; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.5rem; }
        .stage { background: #102a56; color: white; height: 100%; width: 100%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3rem; border-radius: 15px; }
        .seat-group { display: grid; grid-template-rows: repeat(9, auto); gap: 15px; margin-right: 20px; }
        .seat-row { display: flex; gap: 15px; justify-content: center; height: min-content; align-items: flex-start; }
        .seat { width: 30px; height: 30px; flex-shrink: 0; background: #f1f3f5; border-radius: 4px; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: #000; text-align: center; overflow: hidden; padding: 5px; }
        .seat:hover { background: #1c3fa8; color: white !important; cursor: pointer; transform: scale(1.1); }
        .capacity-section.selected { background: #1c3fa8 !important; color: white !important; }
        .capacity-section.closed { background: #e2eefc !important; color: #666 !important; pointer-events: none; }
        .seat.available { background: #1c3fa8; color: white; }
        .seat.sold-out { background: #ccc; pointer-events: none; }
        .seat.selected { background: #102a56; box-shadow: 0 0 5px rgba(16,42,86,0.45); color: white !important; }

        /* list view styles */
        #list-view { width: 100%; border-radius: 8px; overflow: hidden; background: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        #list-view .event-row { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid #eee; transition: background 0.3s ease; }
        #list-view .event-row:hover { background: #f8f9fa; }
        #list-view .event-row:last-child { border-bottom: none; }
        #list-view .event-image { flex: 0 0 150px; }
        #list-view .event-image img { width: 150px; height: 100px; object-fit: cover; border-radius: 8px; }
        #list-view .event-info { flex: 1; padding: 0 1rem; }
        #list-view .event-info h3 { font-size: 1.25rem; font-weight: bold; color: #2f3138; margin-bottom: 0.5rem; }
        #list-view .event-info .meta { display: flex; flex-wrap: wrap; gap: 1rem; color: #6c757d; font-size: 0.9rem; }
        #list-view .event-action { flex: 0 0 200px; display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem; }
        #list-view .event-action .price { font-size: 1rem; font-weight: 600; color: #1c3fa8; }
        #list-view .event-action button { background: #1c3fa8; color: white; padding: 0.5rem 1.5rem; border-radius: 20px; border: none; font-size: 0.9rem; cursor: pointer; transition: background 0.3s ease; }
        #list-view .event-action button:hover { background: #102a56; }

        /* price slider styles */
        #price-slider { margin: 1rem 0; height: 8px; background: #dee2e6; border-radius: 4px; overflow: visible; width: 93%; margin: 1rem auto; }
        #price-slider .ui-slider-range { background: #1c3fa8; height: 100%; border-radius: 4px; }
        #price-slider .ui-slider-handle { background: #fff; border: 2px solid #1c3fa8; border-radius: 50%; width: 16px; height: 16px; top: -4px; cursor: pointer; position: absolute; }
        #price-slider .ui-slider-handle:focus { outline: none; }
        .price-values { display: flex; justify-content: space-between; font-size: 0.9rem; color: #2f3138; }

    </style>
</head>

<body data-page="events">
    <div style="height: 40px;"></div>
    <header id="header">
        <div class="container">
            <div id="logo" class="pull-left">
                <a href="/home.html" class="scrollto"><img src="navImage.png" alt="Williamstown High School Crest"></a>
            </div>
            <nav id="nav-menu-container">
                <ul class="nav-menu">
                    <li><a href="/home.html">Home</a></li>
                    <li><a href="/home.html#about">About</a></li>
                    <li class="menu-active"><a href="/event.html">Events</a></li>
                   <li><a href="/rent.html">Rent Venue</a></li>
                    <li class="buy-tickets"><a href="/login.html" id="loginButton">Log In</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="popup-overlay" id="ticketOverlay"></div>
    <div class="ticket-popup" id="ticketPopup">
        <span class="popup-close" id="popupClose">×</span>
        <div class="popup-grid">
            <div class="event-details">
                <h2 class="text-2xl font-bold mb-4">Event Title</h2>
                <div class="seating-chart">
                    <!-- seating chart content goes here -->
                </div>
                <table class="schedule-table"></table>
                <div class="availability">
                    <span>Available Seats:</span>
                    <span class="font-bold text-blue-600">1,234/3,500</span>
                </div>
                <div class="selected-seats-display availability">
                    <span>Selected Seats:</span>
                    <span class="font-bold text-blue-600" id="selectedSeatsText">None</span>
                </div>
            </div>
            <div class="registration-form">
                <h3 class="text-xl font-bold mb-4">Purchase Tickets</h3>
                <div id="totalCost" class="text-blue-600 text-4xl font-bold mb-4 text-center"></div>
                <form id="ticketForm">
                    <div class="form-group"><label>Name</label><input type="text" id="fullName" required></div>
                    <div class="form-group"><label>Email</label><input type="email" id="email" required></div>
                    <div class="form-group"><label>Phone Number</label><input type="tel" id="phone" required></div>
                    <div class="form-group"><label>Tickets Quantity</label><input type="number" id="quantity" min="1" max="10" value="1" required></div>
                    <div class="cc-group payment-group">
                        <div class="form-group"><label>Card Payment Number</label><input type="text" id="cardPaymentNumber" class="payment-field"></div>
                        <div class="form-group"><label>Expiry Date</label><input type="month" id="expiry" class="payment-field"></div>
                    </div>
                    <div class="form-group payment-group"><label>CVV</label><input type="text" id="cvv" class="payment-field" maxlength="3"></div>
                    <button type="submit" class="purchase-button">Complete Purchase</button>
                </form>
            </div>
        </div>
    </div>
    

    <section id="events-section">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-1/4">
                    <div class="filter-sidebar">
                        <div class="relative mb-6">
                            <input type="text" id="searchInput" class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Search events...">
                            <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                        </div>
                        <div class="filter-section active">
                            <div class="filter-header" onclick="toggleFilter(this)">
                                <h3 class="font-semibold">Categories</h3>
                                <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                            </div>
                            <div class="filter-options">
                                <div class="space-y-2" id="categoryFilters"></div>
                            </div>
                        </div>
                        <div class="filter-section active">
                            <div class="filter-header" onclick="toggleFilter(this)">
                                <h3 class="font-semibold">Price Range</h3>
                                <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                            </div>
                            <div class="filter-options">
                                <div id="price-slider"></div>
                                <div class="price-values">
                                    <span id="min-price">$0</span> - <span id="max-price">$100</span>
                                </div>
                            </div>
                        </div>
                        <div class="filter-section active">
                            <div class="filter-header" onclick="toggleFilter(this)">
                                <h3 class="font-semibold">Date</h3>
                                <i class="fas fa-chevron-down text-gray-400 transition-transform"></i>
                            </div>
                            <div class="filter-options">
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="date" id="startDate" class="p-2 border rounded-lg text-sm">
                                    <input type="date" id="endDate" class="p-2 border rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                        <button class="w-full clear-filters p-2 rounded mb-4 transition mt-4" onclick="clearFilters()">Clear Filters</button>
                        <div class="email-section p-4 rounded">
                            <h2 class="font-bold mb-2">Stay in the Loop</h2>
                            <p class="mb-2 text-gray-600">Get updates about new events and offers</p>
                            <input type="email" id="subscribeEmail" class="w-full p-2 border border-gray-200 rounded mb-2" placeholder="your@email.com">
                            <button id="subscribeBtn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition">Subscribe</button>
                        </div>
                        
                    </div>
                </div>
                <div class="w-full md:w-3/4">
                    <div class="flex justify-between items-center mb-6">
                        <h2 id="eventCount" class="text-2xl font-bold text-gray-800">Loading Events...</h2>
                        <div class="flex gap-2">
                            <button id="box-btn" class="view-toggle active hover:scale-105 transition-transform"><i class="fas fa-th"></i></button>
                            <button id="list-btn" class="view-toggle hover:scale-105 transition-transform"><i class="fas fa-bars"></i></button>
                        </div>
                    </div>
                    <div id="box-view" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                    <div id="list-view" class="space-y-4 hidden"></div>
                </div>
            </div>
        </div>
    </section>

    
    <!-- Firebase stuff -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- firebase config -->
    <script>
      const runtime = window.SchedraSite || null;
      const firebaseConfig = runtime && runtime.getFirebaseConfig ? runtime.getFirebaseConfig() : {
        apiKey: "AIzaSyC0BYFCxwgu3tHp_3oeLsxoMBpyDRnj8IA",
        authDomain: "panthervenue.firebaseapp.com",
        projectId: "panthervenue",
        storageBucket: "panthervenue.appspot.com",
        messagingSenderId: "15387964560",
        appId: "1:15387964560:web:b9dbc68e3a97dd466b5415"
      };

      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const auth = firebase.auth()
      const db = firebase.firestore();
    </script>
    
    <!-- Main App Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            new WOW().init();

            let currentUser = null;
            let events = [];
            let filteredEvents = [];
            let currentView = 'box';
            let currentEvent = null;

            const loginButton = document.getElementById('loginButton');
            const ticketPopup = document.getElementById('ticketPopup');
            const ticketOverlay = document.getElementById('ticketOverlay');

            const eventsConfig = runtime && runtime.getEventsConfig ? runtime.getEventsConfig() : {};
            const collections = runtime && runtime.getCollections ? runtime.getCollections() : {};
            const eventsCollection = collections.events || eventsConfig.collection || 'events_bridgewater';
            const usersCollection = collections.users || 'users_bridgewater';
            const ticketsCollection = collections.tickets || collections.registrations || 'tickets_bridgewater';
            const subscribersCollection = collections.newsletter || collections.subscribers || 'newsletter_bridgewater';
            const scheduleTemplates = eventsConfig.schedules || {};
            const fallbackSchoolId = runtime && runtime.getConfig ? (runtime.getConfig().defaultSchoolId || null) : null;
            const schoolId = runtime && runtime.getActiveSchoolId ? runtime.getActiveSchoolId() : fallbackSchoolId;
            const AUTH_STORAGE_KEY = 'schedra:authState';

            const readStoredAuth = () => {
                try {
                    return JSON.parse(localStorage.getItem(AUTH_STORAGE_KEY) || 'null');
                } catch (err) {
                    return null;
                }
            };

            const persistStoredAuth = (payload) => {
                try {
                    if (payload) {
                        localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(payload));
                    } else {
                        localStorage.removeItem(AUTH_STORAGE_KEY);
                    }
                } catch (err) {
                    /* ignore storage failures */
                }
            };

            if (loginButton) {
                const storedAuth = readStoredAuth();
                if (storedAuth) {
                    loginButton.textContent = 'Dashboard';
                    loginButton.href = '/login.html';
                }
            }

            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    let userDoc = await db.collection(usersCollection).doc(user.uid).get();
                    if (!userDoc.exists) {
                        await db.collection(usersCollection).doc(user.uid).set({
                            email: user.email || '',
                            username: (user.email || '').split('@')[0] || 'User',
                            isAdmin: false,
                            schoolId: schoolId || fallbackSchoolId || 'bridgewater',
                            created: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                        userDoc = await db.collection(usersCollection).doc(user.uid).get();
                    }
                    const userData = userDoc.data() || {};
                    if ((!userData.schoolId) && schoolId) {
                        await db.collection(usersCollection).doc(user.uid).set({ schoolId }, { merge: true });
                        userData.schoolId = schoolId;
                    }
                    currentUser = { uid: user.uid, ...userData, schoolId: userData.schoolId || schoolId };
                    if (loginButton) {
                        loginButton.textContent = 'Dashboard';
                        loginButton.href = '/login.html';
                    }
                    persistStoredAuth({
                        uid: user.uid,
                        email: user.email || userData.email || '',
                        username: userData.username || '',
                        isAdmin: !!userData.isAdmin
                    });
                } else {
                    currentUser = null;
                    persistStoredAuth(null);
                    if (loginButton) {
                        loginButton.textContent = 'Log In';
                        loginButton.href = '/login.html';
                    }
                }
                await initPage();
            });
            
            async function initPage() {
                document.getElementById('eventCount').innerHTML = '<h2>Loading Events...</h2>';
                const defaults = Array.isArray(eventsConfig.defaults) ? eventsConfig.defaults : [];
                const configVersion = runtime && runtime.getConfig ? (runtime.getConfig().version || null) : null;
                let eventsSnapshot = await db.collection(eventsCollection).get();
                if (defaults.length && runtime && runtime.seedCollection) {
                    const existingMap = new Map(eventsSnapshot.docs.map(doc => [doc.id, doc.data()]));
                    const missing = [];
                    const updates = [];
                    defaults.forEach(event => {
                        if (!event || !event.id) return;
                        const payload = { ...event, configVersion };
                        const existing = existingMap.get(String(event.id));
                        if (!existing) {
                            missing.push(payload);
                        } else if (configVersion && existing.configVersion !== configVersion) {
                            updates.push(payload);
                        }
                    });
                    if (missing.length) {
                        await runtime.seedCollection(db, eventsCollection, missing, {
                            attachSchoolId: true,
                            keyField: 'id',
                            merge: false
                        });
                    }
                    if (updates.length) {
                        await runtime.seedCollection(db, eventsCollection, updates, {
                            attachSchoolId: true,
                            keyField: 'id',
                            merge: true
                        });
                    }
                    if (missing.length || updates.length) {
                        eventsSnapshot = await db.collection(eventsCollection).get();
                    }
                }
                events = eventsSnapshot.docs
                    .map(doc => ({ id: doc.id, ...doc.data() }))
                    .filter(event => !schoolId || !event.schoolId || event.schoolId === schoolId);

                // sort events by date, closest to furthest
                const today = new Date().toISOString().split('T')[0]; 
                events.sort((a, b) => {
                    const aIsPast = a.date < today;
                    const bIsPast = b.date < today;
                    if (aIsPast && !bIsPast) return 1;
                    if (!aIsPast && bIsPast) return -1;
                    return new Date(a.date) - new Date(b.date);
                });

                filteredEvents = [...events];

                populateCategories();
                renderEvents();
                updateEventCount();
                setupEventListeners();
                initPriceSlider();
            }
            // ok restored the original generateSeats func
            function generateSeats() {
                const seatGroups = document.querySelectorAll('.seat-group');
                const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                seatGroups.forEach((group, colIndex) => {
                    for (let i = 0; i < 8; i++) {
                        const seatRow = document.createElement('div');
                        seatRow.className = 'seat-row';
                        for (let seatNum = 1; seatNum <= 2; seatNum++) {
                            const seat = document.createElement('div');
                            seat.className = 'seat ' + (Math.random() < 0.7 ? 'available' : 'sold-out');
                            const rowLetter = rows[colIndex];
                            seat.textContent = `${rowLetter}${i * 2 + seatNum}`;
                            seatRow.appendChild(seat);
                        }
                        group.appendChild(seatRow);
                    }
                });
            }

            // restored the full ticket popup logic
            window.showTicketPopup = function(eventId) {
                if (!currentUser) {
                    alert('Please log in to purchase tickets.');
                    window.location.href = '/login.html';
                    return;
                }
                const event = events.find(e => e.id === eventId);
                if (!event) return;
                currentEvent = event;

                ticketPopup.querySelector('h2').textContent = event.title;
                const seatingChartDiv = ticketPopup.querySelector('.seating-chart');
                seatingChartDiv.innerHTML = ''; // Clear previous content
                document.getElementById('selectedSeatsText').textContent = 'None';

                if (['Athletics', 'Workshops', 'Gatherings'].includes(event.category)) {
                    seatingChartDiv.innerHTML = `
                        <div class="arena-container2">
                            <div class="capacity-section north">NORTH STAND • 1000 SEATS</div>
                            <div class="capacity-section south">SOUTH STAND • 1000 SEATS</div>
                            <div class="capacity-section east">EAST STAND • 750 SEATS</div>
                            <div class="capacity-section west">WEST STAND • 750 SEATS</div>
                            <div class="main-floor2">
                                <div class="court-display">
                                    <div class="court-text">MAIN COURT</div>
                                    <div class="court-subtext">Performance-ready Surface</div>
                                </div>
                            </div>
                        </div>
                    `;
                    const stands = seatingChartDiv.querySelectorAll('.capacity-section');
                    stands.forEach(stand => {
                        stand.addEventListener('click', () => {
                            const quantity = parseInt(document.getElementById('quantity').value);
                            stands.forEach(s => s.classList.remove('selected'));
                            stand.classList.add('selected');
                            const selectedStand = stand.textContent.split(' • ')[0];
                            document.getElementById('selectedSeatsText').textContent = `Stand: ${selectedStand} (${quantity})`;
                        });
                    });
                } else if (['Performances', 'Competitions'].includes(event.category)) {
                    seatingChartDiv.innerHTML = `
                        <div class="arena-container">
                            <div class="capacity-section north closed">NORTH STAND (CLOSED)</div>
                            <div class="capacity-section south">SOUTH STAND • 1000 SEATS</div>
                            <div class="capacity-section east">EAST STAND • 750 SEATS</div>
                            <div class="capacity-section west">WEST STAND • 750 SEATS</div>
                            <div class="stage-container"><div class="stage">MAIN STAGE</div></div>
                            <div class="main-floor">
                                <div class="seating-grid" style="display: flex; padding-left: 10px; padding-top: 50px;">
                                    <div class="seat-group"></div><div class="seat-group"></div><div class="seat-group"></div><div class="seat-group"></div>
                                    <div class="seat-group"></div><div class="seat-group"></div><div class="seat-group"></div><div class="seat-group"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    generateSeats(); // Call the restored helper function
                    const quantityInput = document.getElementById('quantity');
                    const seats = seatingChartDiv.querySelectorAll('.seat.available');
                    const selectedSeats = new Set();
                    seats.forEach(seat => {
                        seat.addEventListener('click', () => {
                            const quantity = parseInt(quantityInput.value);
                            if (selectedSeats.has(seat)) {
                                selectedSeats.delete(seat);
                                seat.classList.remove('selected');
                            } else if (selectedSeats.size < quantity) {
                                selectedSeats.add(seat);
                                seat.classList.add('selected');
                            } else {
                                alert('You have reached the maximum number of tickets.');
                            }
                            const selectedSeatLabels = Array.from(selectedSeats).map(s => s.textContent).join(', ');
                            document.getElementById('selectedSeatsText').textContent = selectedSeatLabels || 'None';
                        });
                    });
                    quantityInput.addEventListener('change', () => {
                        selectedSeats.clear();
                        seats.forEach(seat => seat.classList.remove('selected'));
                        document.getElementById('selectedSeatsText').textContent = 'None';
                    });
                    const stands = seatingChartDiv.querySelectorAll('.capacity-section:not(.closed)');
                    stands.forEach(stand => {
                        stand.addEventListener('click', () => {
                            const quantity = parseInt(document.getElementById('quantity').value);
                            stands.forEach(s => s.classList.remove('selected'));
                            stand.classList.add('selected');
                            const selectedStand = stand.textContent.split(' • ')[0];
                            document.getElementById('selectedSeatsText').textContent = `Stand: ${selectedStand} (${quantity})`;
                        });
                    });
                }

                const scheduleTable = ticketPopup.querySelector('.schedule-table');
                scheduleTable.innerHTML = '';
                const schedule = (event.schedule && Array.isArray(event.schedule)) ? event.schedule : (scheduleTemplates[event.category] || []);
                schedule.forEach(item => {
                    scheduleTable.appendChild(document.createElement('tr')).innerHTML = `<td>${item.event}</td><td>${item.time}</td>`;
                });

                const price = event.price;
                document.getElementById('totalCost').dataset.price = price;
                document.getElementById('quantity').value = 1;
                updateTotalCost(price, 1);

                document.querySelectorAll('.payment-group').forEach(group => group.style.display = price > 0 ? 'block' : 'none');
                document.querySelectorAll('.payment-field').forEach(input => input.required = price > 0);

                document.getElementById('fullName').value = currentUser.username || '';
                document.getElementById('email').value = currentUser.email || '';
                
                ticketPopup.classList.add('active');
                ticketOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function initPriceSlider() {
                if (events.length === 0) return;
                const prices = events.map(e => e.price);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                $("#price-slider").slider({
                    range: true, min: minPrice, max: maxPrice, values: [minPrice, maxPrice],
                    slide: (event, ui) => {
                        $("#min-price").text(`$${ui.values[0].toFixed(2)}`);
                        $("#max-price").text(`$${ui.values[1].toFixed(2)}`);
                    },
                    stop: () => filterEvents()
                });
                $("#min-price").text(`$${minPrice.toFixed(2)}`);
                $("#max-price").text(`$${maxPrice.toFixed(2)}`);
            }

            function updateTotalCost(price, quantity) {
                const totalCostElement = document.getElementById('totalCost');
                if (price === 0) {
                    totalCostElement.textContent = 'FREE';
                } else {
                    totalCostElement.textContent = `$${(price * quantity).toFixed(2)}`;
                }
            }
            
            function closeTicketPopup() {
                ticketPopup.classList.remove('active');
                ticketOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            }

            function filterEvents() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(cb => cb.value);
                const [minPrice, maxPrice] = $("#price-slider").slider("values");

                filteredEvents = events.filter(event => 
                    (event.title.toLowerCase().includes(searchTerm) || event.desc.toLowerCase().includes(searchTerm)) &&
                    (!startDate || event.date >= startDate) &&
                    (!endDate || event.date <= endDate) &&
                    (selectedCategories.length === 0 || selectedCategories.includes(event.category)) &&
                    (event.price >= minPrice && event.price <= maxPrice)
                );
                renderEvents();
                updateEventCount();
            }

            window.clearFilters = function() {
                document.getElementById('searchInput').value = '';
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                document.querySelectorAll('.category-checkbox').forEach(cb => cb.checked = false);
                initPriceSlider(); // Reset slider to full range
                filteredEvents = [...events];
                renderEvents();
                updateEventCount();
            }

            function renderEvents() {
                const boxView = document.getElementById('box-view');
                const listView = document.getElementById('list-view');
                boxView.innerHTML = '';
                listView.innerHTML = '';
                if (!events.length) {
                    const emptyMessage = `<p class="col-span-3 text-center text-gray-500 py-10">No events have been published yet. Check back soon!</p>`;
                    boxView.innerHTML = emptyMessage;
                    listView.innerHTML = emptyMessage;
                    return;
                }
                if(filteredEvents.length === 0) {
                    const filteredMessage = `<p class="col-span-3 text-center text-gray-500 py-10">No events match your filters. Adjust your search to see more.</p>`;
                    boxView.innerHTML = filteredMessage;
                    listView.innerHTML = filteredMessage;
                    return;
                }
                filteredEvents.forEach(event => {
                    boxView.innerHTML += createEventCard(event, 'box');
                    listView.innerHTML += createEventCard(event, 'list');
                });
                addFadeIn(currentView);
            }

            function createEventCard(event, viewType) {
                const priceDisplay = event.price > 0 ? `$${event.price.toFixed(2)}` : 'FREE';
                const formattedDate = new Date(event.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                if (viewType === 'box') {
                return `<div class="event-card p-4"><div class="relative mb-4"><img src="${event.image}" class="w-full h-40 object-cover rounded-lg" alt="${event.title}"><span class="date-tag absolute top-2 right-2">${formattedDate}</span></div><h3 class="text-lg font-bold text-gray-800 mb-2">${event.title}</h3><div class="event-meta text-sm mb-2"><span class="flex items-center"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>${event.location}</span><span class="flex items-center"><i class="fas fa-dollar-sign mr-2 text-blue-500"></i>${priceDisplay}</span></div><div class="event-meta text-sm mb-4"><span class="flex items-center text-gray-500"><i class="fas fa-tag mr-2"></i>${event.category}</span></div><p class="text-gray-600 event-description">${event.desc}</p><button onclick="showTicketPopup('${event.id}')" class="register-button bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700">Register Now</button></div>`;
                }
                return `<div class="event-row"><div class="event-image"><img src="${event.image}" alt="${event.title}"></div><div class="event-info"><h3>${event.title}</h3><div class="meta"><span><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>${event.location}</span><span><i class="fas fa-calendar-day mr-2 text-blue-500"></i>${new Date(event.date).toLocaleDateString()}</span><span><i class="fas fa-dollar-sign mr-2 text-blue-500"></i>${priceDisplay}</span><span><i class="fas fa-tag mr-2 text-gray-500"></i>${event.category}</span></div></div><div class="event-action"><button onclick="showTicketPopup('${event.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition">Register Now</button></div></div>`;
            }

            function updateEventCount() {
                const welcomeName = currentUser ? currentUser.username : 'Guest';
                const eventCountEl = document.getElementById('eventCount');
                if (!events.length) {
                    eventCountEl.innerHTML = `Welcome, <span class="text-blue-600">${welcomeName}</span>! No events have been published yet.`;
                    return;
                }
                eventCountEl.innerHTML = `Welcome, <span class="text-blue-600">${welcomeName}</span>! Showing <span class="text-blue-600">${filteredEvents.length}</span> events:`;
            }

            // restored the staggered animation
            function addFadeIn(viewType) {
                const selector = viewType === 'box' ? '#box-view .event-card' : '#list-view .event-row';
                const eventCards = document.querySelectorAll(selector);
                eventCards.forEach((card, index) => {
                    card.style.opacity = 0;
                    card.style.transform = "translateY(20px)";
                    setTimeout(() => {
                        card.style.opacity = 1;
                        card.style.transform = "translateY(0)";
                        card.style.transition = "opacity 0.5s ease, transform 0.5s ease";
                    }, index * 50); // the key is this staggered delay
                });
            }

            window.toggleFilter = function(header) {
                const section = header.parentElement;
                section.classList.toggle('active');
                const icon = header.querySelector('i');
                icon.classList.toggle('fa-chevron-down');
                icon.classList.toggle('fa-chevron-up');
            }

            function populateCategories() {
                const container = document.getElementById('categoryFilters');
                const categories = [...new Set(events.map(event => event.category))];
                container.innerHTML = '';
                categories.forEach(category => {
                    const count = events.filter(e => e.category === category).length;
                    container.innerHTML += `<label class="checkbox-item"><input type="checkbox" class="category-checkbox" value="${category}"><span>${category}</span><span>(${count})</span></label>`;
                });
            }

            function setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', filterEvents);
                document.getElementById('startDate').addEventListener('change', filterEvents);
                document.getElementById('endDate').addEventListener('change', filterEvents);
                document.getElementById('categoryFilters').addEventListener('change', filterEvents);
                
                document.getElementById('box-btn').addEventListener('click', () => { currentView = 'box'; document.getElementById('box-view').classList.remove('hidden'); document.getElementById('list-view').classList.add('hidden'); document.getElementById('box-btn').classList.add('active'); document.getElementById('list-btn').classList.remove('active'); addFadeIn('box'); });
                document.getElementById('list-btn').addEventListener('click', () => { currentView = 'list'; document.getElementById('list-view').classList.remove('hidden'); document.getElementById('box-view').classList.add('hidden'); document.getElementById('list-btn').classList.add('active'); document.getElementById('box-btn').classList.remove('active'); addFadeIn('list'); });
                
                document.getElementById('ticketForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    if(!currentUser || !currentEvent) return;

                    const seatingText = document.getElementById('selectedSeatsText').textContent;
                    const seatingInfo = parseSeatingInfo(seatingText);
                    if (!seatingInfo) { alert('Please select seating.'); return; }

                    const formData = {
                        name: document.getElementById('fullName').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value,
                        cardPaymentNumber: document.getElementById('cardPaymentNumber').value,
                        expiry: document.getElementById('expiry').value,
                        cvv: document.getElementById('cvv').value,
                        quantity: parseInt(document.getElementById('quantity').value)
                    };
                    const price = parseFloat(document.getElementById('totalCost').dataset.price);
                    if (!validateForm(formData, price > 0)) return;
                    
                    const registration = {
                        userId: currentUser.uid, username: currentUser.username, eventId: currentEvent.id, eventName: currentEvent.title, eventDate: currentEvent.date,
                        quantity: formData.quantity, seatingInfo: seatingInfo, totalCost: price * formData.quantity, name: formData.name, email: formData.email, phone: formData.phone,
                        cardPaymentNumber: (price > 0) ? `**** **** **** ${formData.cardPaymentNumber.slice(-4)}` : '', expiry: (price > 0) ? formData.expiry : '', cvv: '',
                        schoolId: schoolId || currentEvent.schoolId || fallbackSchoolId || 'bridgewater',
                        created: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                   try {
                       await db.collection(ticketsCollection).add(registration);
                        if (currentUser && (registration.name || registration.phone)) {
                            await db.collection(usersCollection).doc(currentUser.uid).set({
                                fullName: registration.name,
                                phone: registration.phone
                            }, { merge: true });
                        }
                       alert('Purchase successful! Check your account dashboard for tickets.');
                       closeTicketPopup();
                    } catch (error) {
                        console.error("Error completing purchase:", error);
                        alert("There was an error processing your purchase. Please try again.");
                    }
                });

                document.getElementById('popupClose').addEventListener('click', closeTicketPopup);
                ticketOverlay.addEventListener('click', closeTicketPopup);
                document.getElementById('quantity').addEventListener('change', () => {
                    const price = parseFloat(document.getElementById('totalCost').dataset.price);
                    const quantity = parseInt(document.getElementById('quantity').value);
                    updateTotalCost(price, quantity);
                });

                document.getElementById('subscribeBtn').addEventListener('click', async function() {
                    const email = document.getElementById('subscribeEmail').value.trim();
                    if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                        try {
                            const subscriberDocId = schoolId ? `${schoolId}:${email}` : email;
                            await db.collection(subscribersCollection).doc(subscriberDocId).set({
                                email,
                                schoolId: schoolId || fallbackSchoolId || 'bridgewater',
                                subscribedAt: firebase.firestore.FieldValue.serverTimestamp()
                            }, { merge: true });
                            alert('Subscribed successfully!');
                            document.getElementById('subscribeEmail').value = '';
                        } catch (error) { alert("Could not subscribe. Please try again."); }
                    } else { alert('Please enter a valid email address.'); }
                });
            }

            function parseSeatingInfo(seatingText) {
                if (seatingText === 'None' || !seatingText) return null;
                if (seatingText.includes('Stand:')) {
                    const [standPart, quantityPart] = seatingText.split('(');
                    const stand = standPart.replace('Stand: ', '').trim();
                    const quantity = parseInt(quantityPart.replace(')', '').trim());
                    return { type: 'stand', stand, quantity };
                } else {
                    const seats = seatingText.split(', ').map(seat => seat.trim());
                    return { type: 'seats', seats };
                }
            }

            function validateForm(formData, requirePayment) {
                if (!formData.name || !formData.email || !formData.phone) { alert('Please fill in all required fields.'); return false; }
                if (requirePayment) {
                    if (!formData.cardPaymentNumber || formData.cardPaymentNumber.length < 16) { alert('Please enter a valid card number.'); return false; }
                    if (!formData.expiry || !formData.cvv || formData.cvv.length < 3) { alert('Please enter valid payment details.'); return false; }
                }
                return true;
            }
        });
    </script>
    
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>



  <!-- START: Chatbot Integration Body -->
<!-- Chatbot Toggler -->
<button id="chatbot-toggler">
  <span class="material-symbols-rounded">mode_comment</span>
  <span class="material-symbols-rounded">close</span>
</button>
<div class="chatbot-popup" style="opacity: 0; ">
  <!-- Chatbot Header -->
  <div class="chat-header">
    <div class="header-info">
      <img src="aiprofile.png" alt="AI Profile Logo" class="chatbot-logo" />
      <h2 class="logo-text">WilliamstownBot</h2>
    </div>
    <button id="close-chatbot" class="material-symbols-rounded">keyboard_arrow_down</button>
  </div>
  <!-- Chatbot Body -->
  <div class="chat-body">
    <div class="message bot-message">
      <img src="aiprofile.png" alt="AI Profile Logo" class="bot-avatar" />
      <div class="message-text">Nice to meet you! I'm WilliamstownBot, your AI guide for Williamstown High School. How can I help today?</div>
    </div>
  </div>
  <!-- Chatbot Footer -->
  <div class="chat-footer">
    <form action="#" class="chat-form">
      <textarea placeholder="Type a message..." class="message-input" required></textarea>
      <div class="chat-controls">
        <button type="button" id="emoji-picker" class="material-symbols-outlined">sentiment_satisfied</button>
        <button type="submit" id="send-message" class="material-symbols-rounded">arrow_upward</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>

<script>
  // Select DOM elements
const chatBody = document.querySelector(".chat-body");
const messageInput = document.querySelector(".message-input");
const sendMessageButton = document.querySelector("#send-message");
const chatForm = document.querySelector(".chat-form");
const chatbotToggler = document.querySelector("#chatbot-toggler");
const closeChatbot = document.querySelector("#close-chatbot");
const chatbotPopup = document.querySelector(".chatbot-popup");
const initialInputHeight = messageInput.scrollHeight;

const API_URL = "https://ai.hackclub.com/chat/completions";
let chatHistory;



const createMessageElement = (content, ...classNames) => {
    const div = document.createElement("div");
    div.classList.add("message", ...classNames); // This can now handle multiple classes (6/4/25)
    div.innerHTML = content;
    return div;
};
// Function to display chat history
const displayChatHistory = () => {
    chatBody.innerHTML = ''; // Clear existing messages
    chatHistory.forEach(msg => {
        if (msg.role === "user") {
            const userMessageContent = `<div class="message-text">${msg.content}</div>`;
            const outgoingMessageDiv = createMessageElement(userMessageContent, "user-message");
            chatBody.appendChild(outgoingMessageDiv);
        } else if (msg.role === "assistant") {
            const botMessageContent = `<img src="aiprofile.png" alt="AI Profile Logo" class="bot-avatar" />
            <div class="message-text">${marked.parse(msg.content)}</div>`;
            const incomingMessageDiv = createMessageElement(botMessageContent, "bot-message");
            chatBody.appendChild(incomingMessageDiv);
        }
    });
    chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
};

// Function to generate bot response
const generateBotResponse = async (incomingMessageDiv) => {
    const messageElement = incomingMessageDiv.querySelector(".message-text");
    const requestOptions = {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            messages: chatHistory,
        }),
    };
    try {
        const response = await fetch(API_URL, requestOptions);
        if (!response.ok) {
            const errorData = await response.json();
            console.error("API Error Response:", errorData);
            throw new Error(`API request failed with status: ${response.status}. ${errorData.error?.message || ''}`);
        }
        const data = await response.json();
        const apiResponseText = data.choices[0].message.content.trim();
        messageElement.innerHTML = marked.parse(apiResponseText);
        chatHistory.push({
            role: "assistant",
            content: apiResponseText,
        });
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    } catch (error) {
        console.error("API Error:", error);
        messageElement.innerText = "Oops! Something went wrong. The AI service might be temporarily unavailable. Please try again later.";
        messageElement.style.color = "#1c3fa8";
    } finally {
        incomingMessageDiv.classList.remove("thinking");
        chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
    }
};

// Function to handle outgoing messages
const handleOutgoingMessage = (e) => {
    e.preventDefault();
    const userMessage = messageInput.value.trim();
    if (!userMessage) return;
    messageInput.value = "";
    messageInput.style.height = `${initialInputHeight}px`;
    chatHistory.push({ role: "user", content: userMessage });
    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    const userMessageContent = `<div class="message-text">${userMessage}</div>`;
    const outgoingMessageDiv = createMessageElement(userMessageContent, "user-message");
    chatBody.appendChild(outgoingMessageDiv);
    chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
    setTimeout(() => {
        const botMessageContent = `<img src="aiprofile.png" alt="AI Profile Logo" class="bot-avatar" />
        <div class="message-text">
          <div class="thinking-indicator">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </div>`;
                const incomingMessageDiv = createMessageElement(botMessageContent, "bot-message", "thinking");
        chatBody.appendChild(incomingMessageDiv);
        chatBody.scrollTo({ top: chatBody.scrollHeight, behavior: "smooth" });
        generateBotResponse(incomingMessageDiv);
    }, 600);
};

// Event listeners for input and form
messageInput.addEventListener("input", () => {
    messageInput.style.height = `${initialInputHeight}px`;
    const newHeight = messageInput.scrollHeight;
    messageInput.style.height = `${newHeight}px`;
});

messageInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 768) {
        handleOutgoingMessage(e);
    }
});

chatForm.addEventListener("submit", handleOutgoingMessage);

// Emoji picker setup
const picker = new EmojiMart.Picker({
    theme: "light",
    skinTonePosition: "none",
    previewPosition: "none",
    onEmojiSelect: (emoji) => {
        const { selectionStart: start, selectionEnd: end } = messageInput;
        messageInput.setRangeText(emoji.native, start, end, "end");
        messageInput.focus();
    },
    onClickOutside: (e) => {
        if (e.target.id === "emoji-picker") {
            document.body.classList.toggle("show-emoji-picker");
        } else if (document.body.classList.contains("show-emoji-picker")) {
            document.body.classList.remove("show-emoji-picker");
        }
    },
});
document.querySelector(".chat-footer").appendChild(picker);

document.querySelector("#emoji-picker").addEventListener("click", (e) => {
    e.stopPropagation();
    document.body.classList.toggle("show-emoji-picker");
});

// Toggle and close functions
function toggleChatbot() {
    document.body.classList.toggle("show-chatbot");
    const isOpen = document.body.classList.contains("show-chatbot");
    localStorage.setItem('chatbotOpen', isOpen);
}

function closeChatbotFunc() {
    document.body.classList.remove("show-chatbot");
    localStorage.setItem('chatbotOpen', false);
}

chatbotToggler.addEventListener("click", toggleChatbot);
closeChatbot.addEventListener("click", closeChatbotFunc);

// Initialize chatbot state and history on page load
document.addEventListener('DOMContentLoaded', () => {
    chatbotPopup.classList.add('no-transition');
    const savedHistory = localStorage.getItem('chatHistory');
    if (savedHistory) {
        chatHistory = JSON.parse(savedHistory);
    } else {
        chatHistory = [
            {
                role: "system",
                content: `You are WilliamstownBot, the expert AI assistant for Williamstown High School. Provide accurate, friendly guidance about campus events, facility rentals, and visitor information. Use Markdown for clarity.

---
### Williamstown High School Snapshot
- **Name:** Williamstown High School
- **Location:** 700 N Tuckahoe Rd, Williamstown, New Jersey.
- **Capacity:** More than 3,200 guests across Braves Stadium, the Performing Arts Center, and the Innovation Lab.
- **Features:** Livestream-ready production suites, digital scoreboards, flexible seating, STEM makerspaces, and recently upgraded audio/lighting systems.
- **Primary Use:** Athletics, fine arts productions, academic showcases, and community gatherings.
- **Signature Amenities:** Retractable seating, modular staging, hospitality support, technology packages, and dedicated rental coordinators.

---
### Featured 2025 Events
- **New Student Orientation (Aug 21)** — welcome incoming Braves with campus tours, schedule pick-up, and a family Q&A session.
- **Braves Twilight Track Invitational (Apr 12)** — relays and field events under the lights at John E. Boucher Track Complex.
- **Friday Night Football vs. Mainland (Sep 19)** — marching band halftime performances, senior recognitions, and a packed student section at Braves Stadium.

---
### Website Guide
- **Events Page (event.html):**
  - Browse upcoming athletics, arts, and academic spotlights.
  - Filter by category, price, and date, then open the ticket popup to reserve seats (login required to check out).
- **Facility Rentals (rent.html):**
  - Submit a 6-step intake form to request Williamstown venues (login required).
  - A coordinator reviews requests within two business days and updates status in the dashboard.
- **Portal Login (login.html):**
  - Students, families, and staff manage tickets, rental requests, and volunteer shifts.
  - Admin users track analytics, approve rentals, and oversee campus programming.

---
### Policies & Contact
- **General Rules:** No outside food or drink, clear bag policy, smoke-free and alcohol-free campus. Service animals only.
- **Parking:** On-site lots available with event signage; fees vary by program.
- **Ticketing:** Non-refundable unless the event is canceled. Transactions limited to 10 tickets; transfers require notifying the box office.
- **Venue Team:** Taylor Morgan (rentals@williamstownhs.org, +1 856-262-8200). Office hours Mon–Fri, 7:30 AM – 4:00 PM.

---
### Persona
- Be upbeat, professional, and student-focused.
- Introduce yourself as WilliamstownBot.
- If information is unavailable, encourage contacting the Williamstown office.`
            },
            {
                role: "assistant",
                content: "Welcome! I’m WilliamstownBot, here to help you navigate Williamstown High School events and rentals. What can I do for you today?"
            }
        ];
    }
    displayChatHistory();
    const isOpen = localStorage.getItem('chatbotOpen') === 'true';
    if (isOpen) {
        document.body.classList.add('show-chatbot');
    } else {
        document.body.classList.remove('show-chatbot');
    }
    setTimeout(() => {
        chatbotPopup.classList.remove('no-transition');
    }, 0);
});
</script>






  <style>
    /* Importing Google Fonts - Inter for Chatbot */
    @import url('https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&display=swap');
    
    /* --- Chatbot Styles --- */
    #chatbot-toggler {
      position: fixed;
      bottom: 30px;
      right: 35px;
      border: none;
      height: 50px;
      width: 50px;
      display: flex;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #1c3fa8; /* Accent */
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
      z-index: 1000; /* Ensure it's above other content */
    }
    body.show-chatbot #chatbot-toggler {
      transform: rotate(90deg);
    }
    #chatbot-toggler span {
      color: #fff;
      position: absolute;
    }
    #chatbot-toggler span:last-child,
    body.show-chatbot #chatbot-toggler span:first-child {
      opacity: 0;
    }
    body.show-chatbot #chatbot-toggler span:last-child {
      opacity: 1;
    }
    .chatbot-popup {
      position: fixed;
      right: 35px;
      bottom: 90px;
      width: 400px; 
      overflow: hidden;
      background: #fff;
      border-radius: 15px;
      opacity: 0;
      pointer-events: none;
      transform: scale(0.2);
      transform-origin: bottom right;
      box-shadow: 0 0 128px 0 rgba(0, 0, 0, 0.1),
        0 32px 64px -48px rgba(0, 0, 0, 0.5);
      transition: all 0.1s ease;
      z-index: 1000;
     visibility: hidden;
    }
    body.show-chatbot .chatbot-popup {
      opacity: 1 !important;
      pointer-events: auto;
      transform: scale(1);
      visibility: visible;
   
    }

    .chatbot-popup.no-transition {
    transition: none !important; /* Prevents animation on page load */
}
    .chat-header {
      display: flex;
      align-items: center;
      padding: 15px 22px;
      background: #1c3fa8; /* Accent */
      border-bottom: 1px solid #d4d4d4;
      justify-content: space-between;
    }
    .chat-header .header-info {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .header-info .chatbot-logo {
      width: 35px;
      height: 35px;
      padding: 2px;
      object-fit: cover;
      flex-shrink: 0;
      background: #fff;
      border-radius: 50%;
    }
    .header-info .logo-text {
      color: #fff;
      font-weight: 600;
      font-size: 1.31rem;
      letter-spacing: 0.02rem;
      font-family: "Inter", sans-serif;
    }
    .chat-header #close-chatbot {
      border: none;
      color: #fff;
      height: 40px;
      width: 40px;
      font-size: 1.9rem;
      margin-right: -10px;
      padding-top: 2px;
      cursor: pointer;
      border-radius: 50%;
      background: none;
      transition: 0.2s ease;
    }
    .chat-header #close-chatbot:hover {
      background: rgba(0, 0, 0, 0.1);
    }
    .chat-body {
      font-family: "Inter", sans-serif;
      padding: 25px 22px;
      gap: 20px;
      display: flex;
      height: 400px; 
      overflow-y: auto;
      margin-bottom: 75px;
      flex-direction: column;
      scrollbar-width: thin;
      scrollbar-color: #ccc transparent;
    }
    .chat-body::-webkit-scrollbar {
      width: 6px;
    }
    .chat-body::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }
    .chat-body .message {
      display: flex;
      gap: 11px;
      align-items: flex-start;
    }
    .chat-body .message .bot-avatar {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      align-self: flex-start;
    }
    .chat-body .message .message-text {
      font-family: "Inter", sans-serif;
      padding: 12px 16px;
      max-width: 75%;
      font-size: 0.95rem;
      word-wrap: break-word;
    }
    .chat-body .bot-message.thinking .message-text {
      padding: 2px 16px;
    }
    .chat-body .bot-message .message-text {
      background: #f0f0f0; /* Light Gray */
      color: #000;
      border-radius: 13px 13px 13px 3px;
    }
    .chat-body .user-message {
      justify-content: flex-end;
    }
    .chat-body .user-message .message-text {
      color: #fff;
      background: #1c3fa8;
      border-radius: 13px 13px 3px 13px;
    }
    /* Markdown formatting inside bot message */
     .bot-message .message-text p,
     .bot-message .message-text h1,
     .bot-message .message-text h2,
     .bot-message .message-text h3,
     .bot-message .message-text ul,
     .bot-message .message-text ol,
     .bot-message .message-text li {
        font-family: "Inter", sans-serif;
        margin-bottom: 0.5em;
        font-size: 0.95rem;
     }
     .bot-message .message-text p:last-child {
        margin-bottom: 0;
     }
     .bot-message .message-text ul, .bot-message .message-text ol {
        padding-left: 20px;
     }
    .chat-body .bot-message .thinking-indicator {
      display: flex;
      gap: 4px;
      padding-block: 15px;
    }
    .chat-body .bot-message .thinking-indicator .dot {
      height: 7px;
      width: 7px;
      opacity: 0.7;
      border-radius: 50%;
      background: #1c3fa8;
      animation: dotPulse 1.8s ease-in-out infinite;
    }
    .chat-body .bot-message .thinking-indicator .dot:nth-child(1) { animation-delay: 0.2s; }
    .chat-body .bot-message .thinking-indicator .dot:nth-child(2) { animation-delay: 0.3s; }
    .chat-body .bot-message .thinking-indicator .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes dotPulse {
      0%, 44% { transform: translateY(0); }
      28% { opacity: 0.4; transform: translateY(-4px); }
      44% { opacity: 0.2; }
    }
    .chat-footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: #fff;
      padding: 10px 22px 15px;
      border-top: 1px solid #d4d4d4;
    }
    .chat-footer .chat-form {
      display: flex;
      align-items: center;
      position: relative;
      background: #fff;
      border-radius: 32px;
      outline: 1px solid #ccc;
      transition: 0s ease;
    }
    .chat-form:focus-within {
      outline: 2px solid #1c3fa8;
    }
    .chat-form .message-input {
      font-family: "Inter", sans-serif;
      width: 100%;
      height: 47px;
      outline: none;
      resize: none;
      border: none;
      max-height: 180px;
      scrollbar-width: none;
      border-radius: inherit;
      font-size: 0.95rem;
      padding: 14px 0 12px 18px;
    }
    .chat-form .message-input::-webkit-scrollbar {
        display: none;
    }
    .chat-form .chat-controls {
      gap: 3px;
      height: 47px;
      display: flex;
      padding-right: 6px;
      align-items: center;
      align-self: flex-end;
    }
    .chat-form .chat-controls button {
      height: 35px;
      width: 35px;
      border: none;
      cursor: pointer;
      color: #555; /* Dark Gray */
      border-radius: 50%;
      font-size: 1.15rem;
      background: none;
      transition: 0.2s ease;
    }
    .chat-form .chat-controls button:hover,
    body.show-emoji-picker .chat-controls #emoji-picker {
      color: #1c3fa8;
      background: #e7f2ff;
    }
    .chat-form .chat-controls #send-message {
      color: #fff;
      background: #1c3fa8;
      /* IPAD FIX: Perfect centering for the icon */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .chat-form .chat-controls #send-message:hover {
      background: #102a56;
    }
    .chat-form .message-input:valid~.chat-controls #send-message {
      display: flex; /* Changed from block to flex for centering fix */
    }
    em-emoji-picker {
      position: absolute;
      left: 50%;
      bottom: 55px; /* Position above the input bar */
      width: 100%;
      max-width: 350px;
      visibility: hidden;
      max-height: 330px;
      transform: translateX(-50%);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    body.show-emoji-picker em-emoji-picker {
      visibility: visible;
    }

    /* IPAD/MOBILE FIX: Make chatbot fullscreen on tablets (portrait) and phones */
    @media (max-width: 768px) {
      #chatbot-toggler {
        right: 20px;
        bottom: 20px;
      }
      .chatbot-popup {
        right: 0;
        bottom: 0;
        height: 100%;
        border-radius: 0;
        width: 100%;
      }
      .chatbot-popup .chat-header {
        padding: 12px 15px;
      }
      .chat-body {
        height: calc(100% - 130px); /* Adjusted for full screen */
        padding: 25px 15px;
      }
      .chat-footer {
        padding: 10px 15px 15px;
      }
    }
  </style>
  <!-- END: Chatbot Integration Head -->
  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- START: Chatbot Integration Head -->
  <!-- Google Fonts for Chatbot Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // 1. Check if the URL has the instruction "?action=play"
    const urlParams = new URLSearchParams(window.location.search);
    const shouldPlay = urlParams.get('action') === 'play';

    if (shouldPlay) {
      // 2. Find the play button on the homepage
      const playButton = document.getElementById('play-button');

      // 3. If the button exists, programmatically "click" it
      if (playButton) {
        playButton.click();
      }
    }
  });
</script>
<script>
document.addEventListener('contextmenu', event => event.preventDefault());

document.onkeydown = function(e) {
  // Block Cmd+Option+I (DevTools)
  if (e.metaKey && e.altKey && e.key.toLowerCase() === 'i') {
    e.preventDefault();
  }

  // Block Cmd+Shift+C (Element picker)
  if (e.metaKey && e.shiftKey && e.key.toLowerCase() === 'c') {
    e.preventDefault();
  }

  // Block Cmd+Shift+J (Console)
  if (e.metaKey && e.shiftKey && e.key.toLowerCase() === 'j') {
    e.preventDefault();
  }

  // Block Cmd+Option+U (View source)
  if (e.metaKey && e.altKey && e.key.toLowerCase() === 'u') {
    e.preventDefault();
  }

  // General: Block F12 (DevTools)
  if (e.key === 'F12') {
    e.preventDefault();
  }
};
</script>

</body>
</html>
